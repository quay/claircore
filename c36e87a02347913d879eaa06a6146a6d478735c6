`Tarfs` robustness fixes

There are changes regarding internal behavior when needing to create
implied directories (previously, the code mistakenly used the file name
instead of the file path) and hard links (the code did not handle hard
links to directories and did not traverse them).
